---
workflow: /gsd:new-milestone
milestone: v1.1 Map Overhaul
step: 6 of 8 (research complete, requirements next)
status: in_progress
last_updated: 2026-01-19
---

<current_state>
We are mid-way through the `/gsd:new-milestone` workflow for v1.1 Map Overhaul.

The research phase is COMPLETE. Four parallel research agents ran and produced:
- STACK.md - Technology recommendations (maplibre-gl + react-map-gl + MapTiler)
- FEATURES.md - Feature landscape (table stakes, differentiators, anti-features)
- ARCHITECTURE.md - Component boundaries, data flow, useMapSearch hook pattern
- PITFALLS.md - Risks and mitigations (SSR, infinite loops, marker migration)
- SUMMARY.md - Synthesized findings with 8-phase structure recommendation

The next step is Phase 7 of the new-milestone workflow: **Define Requirements**.
</current_state>

<completed_work>

**v1 Milestone:**
- SHIPPED and archived (2026-01-19)
- All 4 phases complete (mock auth, production auth, security, email features)
- Tagged as v1, pushed to GitHub

**v1.1 Milestone Setup:**
- User chose scope: MapLibre + new features (bidirectional sync, clustering, /map page, mobile)
- PROJECT.md updated with v1.1 goals and 8 MAP requirements (MAP-01 through MAP-08)
- Research completed with 4 parallel agents + synthesizer
- Research files in `.planning/research/`:
  - STACK.md
  - FEATURES.md
  - ARCHITECTURE.md
  - PITFALLS.md
  - SUMMARY.md
</completed_work>

<remaining_work>

**New-Milestone Workflow (steps 7-8):**
- Step 7: Define Requirements - Create REQUIREMENTS.md from research findings
  - User will scope features as must-have, should-have, nice-to-have
  - Map research findings to formal requirements
- Step 8: Create Roadmap - Spawn gsd-roadmapper to create ROADMAP.md with phases

**After workflow completes:**
- Ready for `/gsd:plan-phase 1` to plan MapLibre Foundation phase
</remaining_work>

<decisions_made>

- **Migration scope:** Full MapLibre migration + new features (not just library swap)
- **Search-map interaction:** Bidirectional (search updates map AND map updates results)
- **Map placement:** Homepage, search page, AND dedicated /map exploration page
- **Version:** v1.1 Map Overhaul

**Research-based decisions (from SUMMARY.md):**
- **Stack:** maplibre-gl ^4.x + react-map-gl ^7.x + MapTiler free tier
- **Clustering:** Use MapLibre native GeoJSON clustering (not external library)
- **State management:** URL-first with shared useMapSearch hook
- **Marker approach:** Symbol layers with category icon sprites (not DOM overlays)
- **Sync pattern:** "Search this area" button (not aggressive auto-refresh)
</decisions_made>

<blockers>
None. Research complete, ready to proceed.
</blockers>

<context>
The user started the MapLibre migration milestone after completing v1 (auth/security fixes).

Key research findings suggest 8 phases:
1. MapLibre Foundation (SSR handling, tile setup, basic rendering)
2. Clustering Implementation (native GeoJSON clustering)
3. Search-to-Map Sync (one-way, useMapSearch hook)
4. Map-to-Search Sync ("Search this area" button)
5. List-Map Hover Sync (polish feature)
6. Dedicated /map Page (full-screen, mobile bottom sheet)
7. Mobile Optimization (cooperative gestures, WebGL recovery)
8. Cleanup and Polish (remove Leaflet, bundle optimization)

Confidence is MEDIUM overall - versions need npm verification before implementation.

The recommended approach is URL-as-source-of-truth with a shared `useMapSearch` hook that replaces the current siloed architecture where BusinessMap and SearchPage fetch independently.
</context>

<files_modified>
- .planning/PROJECT.md (updated with v1.1 milestone and MAP requirements)
- .planning/research/STACK.md (created)
- .planning/research/FEATURES.md (created)
- .planning/research/ARCHITECTURE.md (created)
- .planning/research/PITFALLS.md (created)
- .planning/research/SUMMARY.md (created)
</files_modified>

<next_action>
Resume with: `/gsd:new-milestone` (it will detect research is complete and continue to requirements definition)

Or manually:
1. Read `.planning/research/SUMMARY.md` for context
2. Ask user to scope features from research (must-have vs should-have vs nice-to-have)
3. Create `.planning/REQUIREMENTS.md` with formal requirements
4. Spawn gsd-roadmapper to create ROADMAP.md
5. Update STATE.md with new milestone
</next_action>
