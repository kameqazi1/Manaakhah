---
phase: 01-booking-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
autonomous: true

must_haves:
  truths:
    - "Service model exists in database with name, duration, price, description fields"
    - "Business can have multiple services (one-to-many relationship)"
    - "Services can be linked to bookings"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "Service model definition"
      contains: "model Service"
  key_links:
    - from: "Service"
      to: "Business"
      via: "businessId foreign key"
      pattern: "business Business @relation"
    - from: "Booking"
      to: "Service"
      via: "serviceId foreign key"
      pattern: "service Service @relation"
---

<objective>
Add the Service model to Prisma schema so businesses can define bookable services with structured data (name, duration, price, description).

Purpose: The current system stores service info in localStorage (dashboard services page) and as simple strings in Business.services. This creates a proper Service model that persists to database and can be referenced by bookings.

Output: Updated Prisma schema with Service model and migrated database.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-booking-foundation/01-RESEARCH.md

# Key existing code
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Service model to Prisma schema</name>
  <files>prisma/schema.prisma</files>
  <action>
Add the Service model to prisma/schema.prisma after the BusinessAvailability model (around line 1135). Include these fields:

```prisma
model Service {
  id          String   @id @default(cuid())
  businessId  String
  name        String
  description String?  @db.Text
  price       Float
  priceType   String   @default("fixed") // fixed, starting, hourly, custom
  duration    Int      // in minutes
  category    String?
  isActive    Boolean  @default(true)
  isFeatured  Boolean  @default(false)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  business Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@index([businessId])
  @@index([businessId, isActive])
}
```

Also update the Business model to add the services relation:
- Find the `Business` model relations section (around line 608-631)
- Add: `services Service[]` (near the other relations like `photos`, `tags`)

Update the Booking model to optionally reference a Service:
- Find the Booking model (around line 1047)
- Add: `serviceId String?` field after `serviceType`
- Add: `service Service? @relation(fields: [serviceId], references: [id])` relation

Note: Keep the existing `serviceType String` field for backwards compatibility with existing bookings.
  </action>
  <verify>Run `npx prisma format` to validate schema syntax - should complete without errors</verify>
  <done>Service model exists in schema with all required fields and proper relations to Business and Booking</done>
</task>

<task type="auto">
  <name>Task 2: Generate Prisma client and push schema to database</name>
  <files>prisma/schema.prisma</files>
  <action>
Run the Prisma migration commands:

1. Generate the Prisma client: `npx prisma generate`
2. Push the schema changes to database: `npx prisma db push`

The db push command will:
- Create the new Service table
- Add the serviceId column to Booking table
- Create the necessary indexes

Use `db push` instead of `migrate dev` since this is a development environment and we want to quickly sync the schema. For production, a proper migration would be created.
  </action>
  <verify>Run `npx prisma db push` and confirm it completes successfully. Then run `npx prisma studio` briefly to confirm Service table exists (then close it).</verify>
  <done>Service table exists in database, Booking table has serviceId column, Prisma client is regenerated</done>
</task>

</tasks>

<verification>
- [ ] `npx prisma format` completes without errors
- [ ] `npx prisma generate` completes without errors
- [ ] `npx prisma db push` completes without errors
- [ ] Service model visible in Prisma Studio
</verification>

<success_criteria>
- Service model exists with: id, businessId, name, description, price, priceType, duration, category, isActive, isFeatured, sortOrder, timestamps
- Business model has `services Service[]` relation
- Booking model has optional `serviceId` and `service` relation
- Database schema is synchronized
</success_criteria>

<output>
After completion, create `.planning/phases/01-booking-foundation/01-01-SUMMARY.md`
</output>
