---
phase: 01-booking-foundation
plan: 05
type: execute
wave: 4
depends_on: ["01-02", "01-03"]
files_modified:
  - components/booking/ServiceSelector.tsx
  - components/booking/TimeSlotGrid.tsx
  - components/booking/BookingSummary.tsx
  - app/business/[id]/book/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can see list of business services with prices"
    - "User can select a date from calendar"
    - "User can see available time slots for selected date"
    - "User can select a time slot"
    - "User sees booking summary before confirmation"
    - "Submitting creates a PENDING booking in database"
  artifacts:
    - path: "components/booking/ServiceSelector.tsx"
      provides: "Service selection cards"
      min_lines: 50
    - path: "components/booking/TimeSlotGrid.tsx"
      provides: "Time slot grid display"
      min_lines: 40
    - path: "components/booking/BookingSummary.tsx"
      provides: "Booking confirmation summary"
      min_lines: 40
    - path: "app/business/[id]/book/page.tsx"
      provides: "Public booking page"
      min_lines: 200
  key_links:
    - from: "book/page.tsx"
      to: "/api/businesses/[id]/services"
      via: "fetch services"
      pattern: "fetch.*api/businesses.*services"
    - from: "book/page.tsx"
      to: "/api/businesses/[id]/availability"
      via: "fetch availability"
      pattern: "fetch.*api/businesses.*availability"
    - from: "book/page.tsx"
      to: "/api/bookings"
      via: "POST booking"
      pattern: "fetch.*api/bookings.*POST"
---

<objective>
Create the booking components and public booking page at /business/[id]/book.

Purpose: This is the customer-facing booking flow where users select a service, choose a date/time, and confirm their booking. It's the core deliverable of Phase 1.

Output: Complete booking page with three-step flow (service -> date/time -> confirm).
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-booking-foundation/01-RESEARCH.md

# Components from Plan 02
@components/booking/DatePicker.tsx
@lib/availability.ts

# API routes from Plan 03
# /api/businesses/[id]/services
# /api/businesses/[id]/availability
# /api/bookings

# Existing business page for reference
@app/business/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create booking UI components</name>
  <files>components/booking/ServiceSelector.tsx, components/booking/TimeSlotGrid.tsx, components/booking/BookingSummary.tsx</files>
  <action>
Create three booking components:

1. Create `components/booking/ServiceSelector.tsx`:

```typescript
"use client";

import { Card, CardContent } from "@/components/ui/card";
import { cn } from "@/lib/utils";

interface Service {
  id: string;
  name: string;
  description: string | null;
  price: number;
  priceType: string;
  duration: number;
  isFeatured: boolean;
}

interface ServiceSelectorProps {
  services: Service[];
  selectedService: Service | null;
  onSelect: (service: Service) => void;
}

export function ServiceSelector({ services, selectedService, onSelect }: ServiceSelectorProps) {
  const formatPrice = (service: Service) => {
    if (service.priceType === "custom") return "Contact for Quote";
    const priceStr = `$${service.price.toFixed(2)}`;
    switch (service.priceType) {
      case "starting":
        return `From ${priceStr}`;
      case "hourly":
        return `${priceStr}/hr`;
      default:
        return priceStr;
    }
  };

  const formatDuration = (minutes: number) => {
    if (minutes < 60) return `${minutes} min`;
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;
  };

  if (services.length === 0) {
    return (
      <div className="text-center py-8 text-gray-500">
        No services available for booking at this time.
      </div>
    );
  }

  return (
    <div className="grid gap-3">
      {services.map((service) => (
        <Card
          key={service.id}
          className={cn(
            "cursor-pointer transition-all hover:shadow-md",
            selectedService?.id === service.id
              ? "ring-2 ring-primary border-primary"
              : "hover:border-gray-300",
            service.isFeatured && "border-yellow-200 bg-yellow-50/50"
          )}
          onClick={() => onSelect(service)}
        >
          <CardContent className="p-4">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="flex items-center gap-2">
                  <h3 className="font-semibold">{service.name}</h3>
                  {service.isFeatured && (
                    <span className="px-2 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-700">
                      Popular
                    </span>
                  )}
                </div>
                {service.description && (
                  <p className="text-sm text-gray-600 mt-1">{service.description}</p>
                )}
                <p className="text-xs text-gray-500 mt-2">
                  Duration: {formatDuration(service.duration)}
                </p>
              </div>
              <div className="text-right">
                <span className="font-bold text-lg text-green-600">{formatPrice(service)}</span>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
```

2. Create `components/booking/TimeSlotGrid.tsx`:

```typescript
"use client";

import { Button } from "@/components/ui/button";
import { cn } from "@/lib/utils";
import { formatTimeDisplay } from "@/lib/availability";

interface TimeSlot {
  time: string;
  available: boolean;
  reason?: string;
}

interface TimeSlotGridProps {
  slots: TimeSlot[];
  selectedTime: string | null;
  onSelect: (time: string) => void;
  loading?: boolean;
}

export function TimeSlotGrid({ slots, selectedTime, onSelect, loading }: TimeSlotGridProps) {
  if (loading) {
    return (
      <div className="text-center py-8 text-gray-500">
        Loading available times...
      </div>
    );
  }

  if (slots.length === 0) {
    return (
      <div className="text-center py-8 text-gray-500">
        No available times for this date. Please select another date.
      </div>
    );
  }

  const availableSlots = slots.filter((s) => s.available);
  const unavailableSlots = slots.filter((s) => !s.available);

  return (
    <div className="space-y-4">
      {availableSlots.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          All time slots are booked for this date. Please select another date.
        </div>
      ) : (
        <>
          <p className="text-sm text-gray-600">
            {availableSlots.length} time slot{availableSlots.length !== 1 ? "s" : ""} available
          </p>
          <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">
            {slots.map((slot) => (
              <Button
                key={slot.time}
                variant={selectedTime === slot.time ? "default" : "outline"}
                size="sm"
                disabled={!slot.available}
                onClick={() => slot.available && onSelect(slot.time)}
                className={cn(
                  "w-full",
                  !slot.available && "opacity-50 cursor-not-allowed line-through"
                )}
                title={slot.reason || (slot.available ? "Available" : "Unavailable")}
              >
                {formatTimeDisplay(slot.time)}
              </Button>
            ))}
          </div>
        </>
      )}
    </div>
  );
}
```

3. Create `components/booking/BookingSummary.tsx`:

```typescript
"use client";

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { format } from "date-fns";
import { formatTimeDisplay } from "@/lib/availability";

interface Service {
  id: string;
  name: string;
  price: number;
  priceType: string;
  duration: number;
}

interface Business {
  id: string;
  name: string;
  address: string;
  city: string;
  state: string;
  phone: string;
}

interface BookingSummaryProps {
  business: Business;
  service: Service;
  date: Date;
  time: string;
  notes: string;
  onNotesChange: (notes: string) => void;
  onConfirm: () => void;
  onBack: () => void;
  submitting: boolean;
}

export function BookingSummary({
  business,
  service,
  date,
  time,
  notes,
  onNotesChange,
  onConfirm,
  onBack,
  submitting,
}: BookingSummaryProps) {
  const formatPrice = (service: Service) => {
    if (service.priceType === "custom") return "Contact for Quote";
    const priceStr = `$${service.price.toFixed(2)}`;
    switch (service.priceType) {
      case "starting":
        return `From ${priceStr}`;
      case "hourly":
        return `${priceStr}/hr`;
      default:
        return priceStr;
    }
  };

  const formatDuration = (minutes: number) => {
    if (minutes < 60) return `${minutes} minutes`;
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return mins > 0 ? `${hours} hour${hours > 1 ? "s" : ""} ${mins} min` : `${hours} hour${hours > 1 ? "s" : ""}`;
  };

  return (
    <div className="space-y-4">
      <Card>
        <CardHeader>
          <CardTitle className="text-lg">Booking Summary</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid gap-3">
            <div className="flex justify-between py-2 border-b">
              <span className="text-gray-600">Business</span>
              <span className="font-medium">{business.name}</span>
            </div>
            <div className="flex justify-between py-2 border-b">
              <span className="text-gray-600">Service</span>
              <span className="font-medium">{service.name}</span>
            </div>
            <div className="flex justify-between py-2 border-b">
              <span className="text-gray-600">Date</span>
              <span className="font-medium">{format(date, "EEEE, MMMM d, yyyy")}</span>
            </div>
            <div className="flex justify-between py-2 border-b">
              <span className="text-gray-600">Time</span>
              <span className="font-medium">{formatTimeDisplay(time)}</span>
            </div>
            <div className="flex justify-between py-2 border-b">
              <span className="text-gray-600">Duration</span>
              <span className="font-medium">{formatDuration(service.duration)}</span>
            </div>
            <div className="flex justify-between py-2">
              <span className="text-gray-600">Price</span>
              <span className="font-bold text-green-600 text-lg">{formatPrice(service)}</span>
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">
              Notes for the business (optional)
            </label>
            <Textarea
              placeholder="Any special requests or information..."
              value={notes}
              onChange={(e) => onNotesChange(e.target.value)}
              rows={3}
            />
          </div>

          <div className="bg-blue-50 p-3 rounded-lg text-sm text-blue-700">
            <p className="font-medium">What happens next?</p>
            <p className="mt-1">
              Your booking request will be sent to {business.name}. They will confirm or contact
              you about your appointment.
            </p>
          </div>
        </CardContent>
      </Card>

      <div className="flex gap-3">
        <Button variant="outline" onClick={onBack} className="flex-1" disabled={submitting}>
          Back
        </Button>
        <Button onClick={onConfirm} className="flex-1" disabled={submitting}>
          {submitting ? "Submitting..." : "Confirm Booking"}
        </Button>
      </div>
    </div>
  );
}
```
  </action>
  <verify>Run `npm run build` to ensure all components compile without TypeScript errors.</verify>
  <done>ServiceSelector, TimeSlotGrid, and BookingSummary components exist and compile</done>
</task>

<task type="auto">
  <name>Task 2: Create booking page at /business/[id]/book</name>
  <files>app/business/[id]/book/page.tsx</files>
  <action>
Create `app/business/[id]/book/page.tsx`:

```typescript
"use client";

import { useState, useEffect, useCallback } from "react";
import { useParams, useRouter } from "next/navigation";
import Link from "next/link";
import { format } from "date-fns";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { useMockSession } from "@/components/mock-session-provider";
import { DatePicker } from "@/components/booking/DatePicker";
import { ServiceSelector } from "@/components/booking/ServiceSelector";
import { TimeSlotGrid } from "@/components/booking/TimeSlotGrid";
import { BookingSummary } from "@/components/booking/BookingSummary";

interface Service {
  id: string;
  name: string;
  description: string | null;
  price: number;
  priceType: string;
  duration: number;
  isFeatured: boolean;
}

interface Business {
  id: string;
  name: string;
  address: string;
  city: string;
  state: string;
  zipCode: string;
  phone: string;
  owner: { id: string };
}

interface TimeSlot {
  time: string;
  available: boolean;
  reason?: string;
}

interface AvailabilityData {
  slots: TimeSlot[];
  isOpen: boolean;
  message?: string;
  hours?: { start: string; end: string };
}

type BookingStep = "service" | "datetime" | "confirm";

export default function BookingPage() {
  const params = useParams();
  const router = useRouter();
  const { data: session, mockHeaders } = useMockSession();
  const businessId = params.id as string;

  // Data states
  const [business, setBusiness] = useState<Business | null>(null);
  const [services, setServices] = useState<Service[]>([]);
  const [availability, setAvailability] = useState<AvailabilityData | null>(null);
  const [availableDays, setAvailableDays] = useState<number[]>([]);

  // Booking state
  const [step, setStep] = useState<BookingStep>("service");
  const [selectedService, setSelectedService] = useState<Service | null>(null);
  const [selectedDate, setSelectedDate] = useState<Date | undefined>(undefined);
  const [selectedTime, setSelectedTime] = useState<string | null>(null);
  const [notes, setNotes] = useState("");

  // UI states
  const [loading, setLoading] = useState(true);
  const [loadingSlots, setLoadingSlots] = useState(false);
  const [submitting, setSubmitting] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);

  // Fetch business and services
  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      try {
        // Fetch business
        const bizRes = await fetch(`/api/businesses/${businessId}`);
        if (!bizRes.ok) throw new Error("Business not found");
        const bizData = await bizRes.json();
        setBusiness(bizData);

        // Fetch services
        const svcRes = await fetch(`/api/businesses/${businessId}/services`);
        if (svcRes.ok) {
          const svcData = await svcRes.json();
          setServices(svcData.services || []);
        }

        // Fetch business availability to get open days
        const availRes = await fetch(`/api/businesses/${businessId}/availability/days`);
        if (availRes.ok) {
          const availData = await availRes.json();
          setAvailableDays(availData.days || [0, 1, 2, 3, 4, 5, 6]);
        } else {
          // Default to all days if endpoint doesn't exist
          setAvailableDays([0, 1, 2, 3, 4, 5, 6]);
        }
      } catch (err) {
        console.error("Error fetching data:", err);
        setError("Failed to load booking information");
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [businessId]);

  // Fetch time slots when date changes
  const fetchTimeSlots = useCallback(async () => {
    if (!selectedDate || !selectedService) return;

    setLoadingSlots(true);
    setAvailability(null);

    try {
      const dateStr = format(selectedDate, "yyyy-MM-dd");
      const res = await fetch(
        `/api/businesses/${businessId}/availability?date=${dateStr}&duration=${selectedService.duration}`
      );

      if (res.ok) {
        const data = await res.json();
        setAvailability(data);
      } else {
        setAvailability({ slots: [], isOpen: false, message: "Failed to load availability" });
      }
    } catch (err) {
      console.error("Error fetching slots:", err);
      setAvailability({ slots: [], isOpen: false, message: "Failed to load availability" });
    } finally {
      setLoadingSlots(false);
    }
  }, [businessId, selectedDate, selectedService]);

  useEffect(() => {
    if (selectedDate && selectedService) {
      fetchTimeSlots();
    }
  }, [selectedDate, selectedService, fetchTimeSlots]);

  // Handle service selection
  const handleServiceSelect = (service: Service) => {
    setSelectedService(service);
    setSelectedDate(undefined);
    setSelectedTime(null);
    setStep("datetime");
  };

  // Handle date selection
  const handleDateSelect = (date: Date | undefined) => {
    setSelectedDate(date);
    setSelectedTime(null);
  };

  // Handle time selection
  const handleTimeSelect = (time: string) => {
    setSelectedTime(time);
  };

  // Proceed to confirmation
  const handleProceedToConfirm = () => {
    if (selectedService && selectedDate && selectedTime) {
      setStep("confirm");
    }
  };

  // Submit booking
  const handleConfirmBooking = async () => {
    if (!session?.user?.id) {
      router.push(`/auth/signin?callbackUrl=/business/${businessId}/book`);
      return;
    }

    if (!selectedService || !selectedDate || !selectedTime) return;

    setSubmitting(true);
    setError(null);

    try {
      const res = await fetch("/api/bookings", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          ...mockHeaders,
        },
        body: JSON.stringify({
          businessId,
          serviceId: selectedService.id,
          serviceType: selectedService.name,
          appointmentDate: format(selectedDate, "yyyy-MM-dd"),
          appointmentTime: selectedTime,
          duration: selectedService.duration,
          notes: notes || null,
          price: selectedService.price,
        }),
      });

      if (res.ok) {
        setSuccess(true);
      } else {
        const data = await res.json();
        setError(data.error || "Failed to create booking");
      }
    } catch (err) {
      console.error("Error creating booking:", err);
      setError("Failed to create booking");
    } finally {
      setSubmitting(false);
    }
  };

  // Loading state
  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <p>Loading...</p>
      </div>
    );
  }

  // Error state
  if (!business) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <Card className="max-w-md">
          <CardContent className="p-8 text-center">
            <p className="text-red-600 mb-4">Business not found</p>
            <Link href="/search">
              <Button>Back to Search</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Cannot book own business
  if (session?.user?.id === business.owner?.id) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <Card className="max-w-md">
          <CardContent className="p-8 text-center">
            <p className="text-gray-600 mb-4">You cannot book your own business.</p>
            <Link href={`/business/${businessId}`}>
              <Button>Back to Business</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Success state
  if (success) {
    return (
      <div className="min-h-screen bg-gray-50 py-8">
        <div className="container mx-auto max-w-2xl px-4">
          <Card>
            <CardContent className="p-8 text-center">
              <div className="text-6xl mb-4">✅</div>
              <h2 className="text-2xl font-bold mb-2">Booking Submitted!</h2>
              <p className="text-gray-600 mb-6">
                Your booking request has been sent to {business.name}. They will confirm your
                appointment soon.
              </p>
              <div className="flex gap-3 justify-center">
                <Link href="/bookings">
                  <Button>View My Bookings</Button>
                </Link>
                <Link href={`/business/${businessId}`}>
                  <Button variant="outline">Back to Business</Button>
                </Link>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="container mx-auto max-w-2xl px-4">
        {/* Header */}
        <div className="mb-6">
          <Link
            href={`/business/${businessId}`}
            className="text-sm text-gray-600 hover:text-gray-900 mb-2 inline-block"
          >
            ← Back to {business.name}
          </Link>
          <h1 className="text-2xl font-bold">Book an Appointment</h1>
          <p className="text-gray-600">{business.name}</p>
        </div>

        {/* Progress indicator */}
        <div className="flex items-center gap-2 mb-6">
          <div
            className={`flex items-center gap-2 ${
              step === "service" ? "text-primary font-medium" : "text-gray-400"
            }`}
          >
            <span className="w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center text-sm">
              1
            </span>
            <span className="hidden sm:inline">Service</span>
          </div>
          <div className="flex-1 h-0.5 bg-gray-200" />
          <div
            className={`flex items-center gap-2 ${
              step === "datetime" ? "text-primary font-medium" : "text-gray-400"
            }`}
          >
            <span
              className={`w-6 h-6 rounded-full flex items-center justify-center text-sm ${
                step === "datetime" || step === "confirm"
                  ? "bg-primary text-white"
                  : "bg-gray-200 text-gray-600"
              }`}
            >
              2
            </span>
            <span className="hidden sm:inline">Date & Time</span>
          </div>
          <div className="flex-1 h-0.5 bg-gray-200" />
          <div
            className={`flex items-center gap-2 ${
              step === "confirm" ? "text-primary font-medium" : "text-gray-400"
            }`}
          >
            <span
              className={`w-6 h-6 rounded-full flex items-center justify-center text-sm ${
                step === "confirm" ? "bg-primary text-white" : "bg-gray-200 text-gray-600"
              }`}
            >
              3
            </span>
            <span className="hidden sm:inline">Confirm</span>
          </div>
        </div>

        {error && (
          <div className="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700">
            {error}
          </div>
        )}

        {/* Step 1: Service Selection */}
        {step === "service" && (
          <Card>
            <CardHeader>
              <CardTitle>Select a Service</CardTitle>
            </CardHeader>
            <CardContent>
              <ServiceSelector
                services={services}
                selectedService={selectedService}
                onSelect={handleServiceSelect}
              />
            </CardContent>
          </Card>
        )}

        {/* Step 2: Date & Time Selection */}
        {step === "datetime" && selectedService && (
          <div className="space-y-4">
            <Card>
              <CardHeader>
                <div className="flex items-center justify-between">
                  <CardTitle>Select Date & Time</CardTitle>
                  <Button variant="outline" size="sm" onClick={() => setStep("service")}>
                    Change Service
                  </Button>
                </div>
                <p className="text-sm text-gray-600">
                  Selected: {selectedService.name} ({selectedService.duration} min)
                </p>
              </CardHeader>
              <CardContent>
                <div className="grid md:grid-cols-2 gap-6">
                  {/* Calendar */}
                  <div>
                    <h3 className="font-medium mb-3">Choose a date</h3>
                    <DatePicker
                      selected={selectedDate}
                      onSelect={handleDateSelect}
                      availableDays={availableDays}
                    />
                  </div>

                  {/* Time slots */}
                  <div>
                    <h3 className="font-medium mb-3">
                      {selectedDate
                        ? `Available times for ${format(selectedDate, "MMM d")}`
                        : "Select a date first"}
                    </h3>
                    {selectedDate ? (
                      availability?.isOpen === false ? (
                        <div className="text-center py-8 text-gray-500">
                          {availability.message || "Business is closed on this day"}
                        </div>
                      ) : (
                        <TimeSlotGrid
                          slots={availability?.slots || []}
                          selectedTime={selectedTime}
                          onSelect={handleTimeSelect}
                          loading={loadingSlots}
                        />
                      )
                    ) : (
                      <div className="text-center py-8 text-gray-400">
                        Select a date to see available times
                      </div>
                    )}
                  </div>
                </div>

                {selectedDate && selectedTime && (
                  <div className="mt-6 pt-4 border-t">
                    <Button onClick={handleProceedToConfirm} className="w-full">
                      Continue to Confirmation
                    </Button>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        )}

        {/* Step 3: Confirmation */}
        {step === "confirm" && selectedService && selectedDate && selectedTime && (
          <BookingSummary
            business={business}
            service={selectedService}
            date={selectedDate}
            time={selectedTime}
            notes={notes}
            onNotesChange={setNotes}
            onConfirm={handleConfirmBooking}
            onBack={() => setStep("datetime")}
            submitting={submitting}
          />
        )}

        {/* Login prompt for unauthenticated users */}
        {!session?.user && step === "confirm" && (
          <Card className="mt-4">
            <CardContent className="p-4 text-center">
              <p className="text-gray-600 mb-3">Please sign in to complete your booking</p>
              <Link href={`/auth/signin?callbackUrl=/business/${businessId}/book`}>
                <Button>Sign In</Button>
              </Link>
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  );
}
```
  </action>
  <verify>Run `npm run build` to ensure page compiles. Navigate to /business/[valid-id]/book to verify the page loads.</verify>
  <done>Booking page exists at /business/[id]/book with three-step flow: service selection, date/time selection, confirmation</done>
</task>

<task type="auto">
  <name>Task 3: Create availability days endpoint</name>
  <files>app/api/businesses/[id]/availability/days/route.ts</files>
  <action>
Create `app/api/businesses/[id]/availability/days/route.ts` to return which days a business is open:

```typescript
import { NextResponse } from "next/server";
import { db } from "@/lib/db";

// GET /api/businesses/[id]/availability/days - Get days business is open
export async function GET(
  req: Request,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const { id: businessId } = await params;

    const availability = await db.businessAvailability.findMany({
      where: {
        businessId,
        isAvailable: true,
      },
      select: {
        dayOfWeek: true,
      },
    });

    const days = availability.map((a: { dayOfWeek: number }) => a.dayOfWeek);

    return NextResponse.json({ days });
  } catch (error) {
    console.error("Error fetching availability days:", error);
    return NextResponse.json({ error: "Failed to fetch availability" }, { status: 500 });
  }
}
```

This endpoint returns an array of day numbers (0-6) when the business is available, which the DatePicker uses to disable unavailable days.
  </action>
  <verify>Run `npm run build` to ensure route compiles.</verify>
  <done>Availability days endpoint exists and returns array of open day numbers</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` completes without errors
- [ ] /business/[id]/book page loads
- [ ] Service selection displays services
- [ ] Date picker shows calendar with disabled days
- [ ] Time slots load when date is selected
- [ ] Confirmation step shows booking summary
- [ ] Submitting creates a booking (check via /api/bookings)
</verification>

<success_criteria>
- Three-step booking flow works: service -> date/time -> confirm
- Services loaded from API and displayed with prices/durations
- Calendar disables days when business is closed
- Time slots load dynamically based on date and service duration
- Booking submission creates PENDING record in database
- Error states handled gracefully
- Login redirect for unauthenticated users
</success_criteria>

<output>
After completion, create `.planning/phases/01-booking-foundation/01-05-SUMMARY.md`
</output>
