---
phase: 02-production-auth-flows
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/verify-email/page.tsx
  - app/forgot-password/page.tsx
  - app/reset-password/page.tsx
autonomous: true

must_haves:
  truths:
    - "User sees verification status when clicking email link"
    - "User can request password reset from forgot-password page"
    - "User can set new password from reset-password page"
    - "Invalid/expired tokens show error with resend option"
  artifacts:
    - path: "app/verify-email/page.tsx"
      provides: "Email verification handling UI"
      min_lines: 80
    - path: "app/forgot-password/page.tsx"
      provides: "Password reset request form"
      min_lines: 60
    - path: "app/reset-password/page.tsx"
      provides: "New password form"
      min_lines: 100
  key_links:
    - from: "app/verify-email/page.tsx"
      to: "/api/auth/verify-email"
      via: "fetch POST with token"
      pattern: "fetch.*api/auth/verify-email"
    - from: "app/forgot-password/page.tsx"
      to: "/api/auth/forgot-password"
      via: "fetch POST with email"
      pattern: "fetch.*api/auth/forgot-password"
    - from: "app/reset-password/page.tsx"
      to: "/api/auth/reset-password"
      via: "fetch GET to validate, POST to reset"
      pattern: "fetch.*api/auth/reset-password"
---

<objective>
Create frontend pages for email verification, forgot password, and reset password flows.

Purpose: The backend APIs exist but users have no UI to interact with them. These pages complete the auth flow UX.
Output: Three new pages that handle token-based verification and password reset.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-production-auth-flows/02-CONTEXT.md
@.planning/phases/02-production-auth-flows/02-RESEARCH.md

# Existing patterns to follow
@app/login/page.tsx
@app/register/page.tsx

# APIs these pages will call
@app/api/auth/verify-email/route.ts
@app/api/auth/forgot-password/route.ts
@app/api/auth/reset-password/route.ts
@app/api/auth/resend-verification/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create verify-email page</name>
  <files>app/verify-email/page.tsx</files>
  <action>
Create a client component at `app/verify-email/page.tsx` that:

1. Reads `token` from URL search params using `useSearchParams()`
2. On mount, calls POST `/api/auth/verify-email` with the token
3. Shows loading state ("Verifying your email...")
4. On success:
   - Shows success message with green CheckCircle icon
   - Shows "Redirecting to login..." text
   - Redirects to `/login?verified=true` after 2 seconds
5. On error (invalid/expired token):
   - Shows error message with red XCircle icon
   - Shows "Request new verification link" button
   - Button opens a form to enter email
   - Form calls POST `/api/auth/resend-verification`
   - After resend, show "Check your email" message
6. Handle missing token case (show error immediately)

Use existing UI patterns from login/register pages:
- Card component wrapper
- Same styling classes
- Input/Button/Label from @/components/ui
- Eye/EyeOff not needed here (no password field)
- Use Mail, CheckCircle, XCircle, Loader2 icons from lucide-react

Wrap in Suspense boundary for useSearchParams SSR compatibility.
  </action>
  <verify>
- File exists at `app/verify-email/page.tsx`
- `npm run build` passes without errors
- Manually verify page loads at `/verify-email?token=test`
  </verify>
  <done>
User can visit /verify-email with token param, see verification status, and request new link if token is invalid.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create forgot-password page</name>
  <files>app/forgot-password/page.tsx</files>
  <action>
Create a client component at `app/forgot-password/page.tsx` that:

1. Shows a simple form with email input
2. On submit, calls POST `/api/auth/forgot-password` with email
3. Shows loading state on button
4. After submit (success or failure), ALWAYS show same message:
   "If an account exists with this email, we've sent a password reset link."
   (This prevents email enumeration)
5. Show "Back to login" link
6. Include "Check your spam folder" hint text

Use existing UI patterns:
- Card component with CardHeader, CardContent
- Input for email with Label
- Button for submit
- Same styling as login page
- Use Mail, ArrowLeft icons from lucide-react
  </action>
  <verify>
- File exists at `app/forgot-password/page.tsx`
- `npm run build` passes without errors
- Manually verify page loads at `/forgot-password`
  </verify>
  <done>
User can visit /forgot-password, enter email, and receive confirmation message (regardless of whether email exists).
  </done>
</task>

<task type="auto">
  <name>Task 3: Create reset-password page</name>
  <files>app/reset-password/page.tsx</files>
  <action>
Create a client component at `app/reset-password/page.tsx` that:

1. Reads `token` from URL search params using `useSearchParams()`
2. On mount, calls GET `/api/auth/reset-password?token={token}` to validate
3. States: "validating" | "valid" | "invalid" | "resetting" | "success"

Validating state:
- Show loading spinner and "Validating reset link..."

Invalid state (token expired/missing):
- Show error with XCircle icon
- Message: "This reset link is invalid or has expired"
- Show link to /forgot-password: "Request a new reset link"

Valid state:
- Show password form with:
  - New password field (with Eye/EyeOff toggle)
  - Confirm password field (with Eye/EyeOff toggle)
  - Password requirements hint (min 8 characters)
- On submit, validate passwords match client-side
- Call POST `/api/auth/reset-password` with { token, password }

Success state:
- Show success message with CheckCircle
- "Your password has been reset successfully"
- Show "Continue to login" button -> redirects to /login?reset=true

Use existing UI patterns from login/register pages.
Wrap in Suspense boundary for useSearchParams SSR compatibility.
  </action>
  <verify>
- File exists at `app/reset-password/page.tsx`
- `npm run build` passes without errors
- Manually verify page loads at `/reset-password?token=test`
  </verify>
  <done>
User can visit /reset-password with token, see validation status, enter new password if valid, and see success confirmation.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should pass with no errors
2. All three pages render without crashes:
   - `/verify-email` (shows error for missing token)
   - `/verify-email?token=invalid` (shows error for invalid token)
   - `/forgot-password` (shows email form)
   - `/reset-password` (shows error for missing token)
   - `/reset-password?token=invalid` (shows error for invalid token)
3. Forms submit correctly (API calls work)
4. UI matches existing login/register page styling
</verification>

<success_criteria>
- [ ] verify-email page handles success, error, and resend flows
- [ ] forgot-password page submits email and shows confirmation
- [ ] reset-password page validates token and allows password change
- [ ] All pages follow existing UI patterns
- [ ] Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-production-auth-flows/02-01-SUMMARY.md`
</output>
